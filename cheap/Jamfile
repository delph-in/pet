UNIFIER = tomabechi ;
YY = true ;

TSDB = true ;
ITSDBDIR = /proj/collate/home/uc/src/newlkb ;

ICU = true ;
ICUDIR = /usr/contrib/lib/icu ; 

IQT = false ;
IQTDIR = /home/uc/YY/src/lib/iqtsdk/main ;

CC = gcc ;
C++ = g++ ;

C++FLAGS += -g -Wall ;
CFLAGS += -g -Wall ;

LINK = g++ ;
OPTIM = ;

SEARCH_SOURCE += ../common ;

if $(UNIFIER) = tomabechi
{
  DAGSOURCES = dag-io.cpp dag-common.cpp dag-arced.cpp dag-alloc.cpp
	       dag-tomabechi.cpp failure.cpp qc.cpp ;
  DAGFLAGS = -DDAG_TOMABECHI -DQC_PATH_COMP ;
}
else if $(UNIFIER) = simple
{
  DAGSOURCES = dag-io.cpp dag-common.cpp dag-arced.cpp dag-alloc.cpp
	       dag-simple.cpp ;
  DAGFLAGS = -DDAG_SIMPLE -DWROBLEWSKI2 ;
}

COMMONSOURCES = bitcode.cpp chunk-alloc.cpp errors.cpp mfile.c
        	lex-io.cpp lex-tdl.cpp settings.cpp fs.cpp dumper.cpp
                grammar-dump.cpp grammar.cpp types.cpp tsdb++.cpp
                utility.cpp ;

PARSESOURCES = parse.cpp item.cpp task.cpp chart.cpp agenda.cpp tokenizer.cpp
               options.cpp postags.cpp inputtoken.cpp inputchart.cpp paths.cpp 
	       mrs.cpp ;

CHEAPSOURCES = cheap.cpp $(DAGSOURCES) $(COMMONSOURCES) $(PARSESOURCES) ;

C++FLAGS += $(DAGFLAGS) ;

if $(TSDB) = true
{
  C++FLAGS += -DTSDBAPI -TSDBFILEAPI -DSOCKET_INTERFACE ;
  HDRS += $(ITSDBDIR)/include ;
}

if $(ICU) = true
{
  C++FLAGS += -DICU -DONLINEMORPH ;
  HDRS += $(ICUDIR)/include ;
  CHEAPSOURCES += unicode.cpp morph.cpp ;
}

if $(YY) = true
{
  CHEAPSOURCES += k2y.cpp yy.cpp ;
  C++FLAGS += -DYY ;
}

if $(IQT) = true
{
  CHEAPSOURCES += iqt.cpp ;
  HDRS += $(IQTDIR)/include ;
  C++FLAGS += -DIQT -DIQTEMU ;
}

C++FLAGS += -DHASH_MAP_AVAIL -DUSEMMAP ;

HDRS += . ;

LINKLIBS on cheap = -lm -lstdc++ -liberty ;

if $(TSDB) = true
{
  LINKFLAGS on cheap += -L$(ITSDBDIR)/lib/linux -Xlinker -rpath -Xlinker $(ITSDBDIR)/lib/linux ;
  LINKLIBS on cheap += -litsdb -lpvm3 ;
}

if $(ICU) = true
{
  LINKFLAGS on cheap += -L$(ICUDIR)/lib -Xlinker -rpath -Xlinker $(ICUDIR)/lib ;
  LINKLIBS on cheap += -licuuc -licui18n -lpthread -ldl ;
}

Main cheap : $(CHEAPSOURCES) ; 


if $(TSDB) = false
{
  DUMPGRAMSOURCES = dumpgram.cpp errors.cpp grammar-dump.cpp dumper.cpp ;
  Main dumpgram : $(DUMPGRAMSOURCES) ;
}
